
% Default to the notebook output style

    


% Inherit from the specified cell style.




    
\documentclass[11pt]{article}

    
    
    \usepackage[T1]{fontenc}
    % Nicer default font (+ math font) than Computer Modern for most use cases
    \usepackage{mathpazo}

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % We will generate all images so they have a width \maxwidth. This means
    % that they will get their normal width if they fit onto the page, but
    % are scaled down if they would overflow the margins.
    \makeatletter
    \def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth
    \else\Gin@nat@width\fi}
    \makeatother
    \let\Oldincludegraphics\includegraphics
    % Set max figure width to be 80% of text width, for now hardcoded.
    \renewcommand{\includegraphics}[1]{\Oldincludegraphics[width=.8\maxwidth]{#1}}
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionLabelFormat{nolabel}{}
    \captionsetup{labelformat=nolabel}

    \usepackage{adjustbox} % Used to constrain images to a maximum size 
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage[utf8x]{inputenc} % Allow utf-8 characters in the tex document
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range 
    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    

    
    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatability definitions
    \def\gt{>}
    \def\lt{<}
    % Document parameters
    \title{Generalized Median}
    
    
    

    % Pygments definitions
    
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\expandafter\def\csname PY@tok@w\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\expandafter\def\csname PY@tok@c\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\expandafter\def\csname PY@tok@k\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\expandafter\def\csname PY@tok@o\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ow\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@nb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@nn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@ne\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\expandafter\def\csname PY@tok@nv\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@no\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@nl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@ni\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\expandafter\def\csname PY@tok@na\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\expandafter\def\csname PY@tok@nt\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@nd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\expandafter\def\csname PY@tok@s\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sd\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@si\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@se\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\expandafter\def\csname PY@tok@sr\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\expandafter\def\csname PY@tok@ss\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sx\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@m\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@gh\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gu\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@gd\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@gi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\expandafter\def\csname PY@tok@gr\endcsname{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\expandafter\def\csname PY@tok@ge\endcsname{\let\PY@it=\textit}
\expandafter\def\csname PY@tok@gs\endcsname{\let\PY@bf=\textbf}
\expandafter\def\csname PY@tok@gp\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\expandafter\def\csname PY@tok@go\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\expandafter\def\csname PY@tok@gt\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\expandafter\def\csname PY@tok@err\endcsname{\def\PY@bc##1{\setlength{\fboxsep}{0pt}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}
\expandafter\def\csname PY@tok@kc\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kd\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kn\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@kr\endcsname{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@bp\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\expandafter\def\csname PY@tok@fm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\expandafter\def\csname PY@tok@vc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vg\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@vm\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\expandafter\def\csname PY@tok@sa\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sc\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@dl\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s2\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@sh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@s1\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\expandafter\def\csname PY@tok@mb\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mf\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mh\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mi\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@il\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@mo\endcsname{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\expandafter\def\csname PY@tok@ch\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cm\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cpf\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@c1\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\expandafter\def\csname PY@tok@cs\endcsname{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % Exact colors from NB
    \definecolor{incolor}{rgb}{0.0, 0.0, 0.5}
    \definecolor{outcolor}{rgb}{0.545, 0.0, 0.0}



    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

    \begin{document}
    
    
    \maketitle
    
    

    
    \section{\texorpdfstring{A Robust Measure of Central Tendency in \(N\)
Dimensions}{A Robust Measure of Central Tendency in N Dimensions}}\label{a-robust-measure-of-central-tendency-in-n-dimensions}

\emph{Charles C. Kankelborg}

\subsection{Abstract}\label{abstract}

I describe an N-dimensional generalization of the median that can be
used to find the central tendency of a distribution. The generalized
median is more robust than a centroid, is capable of sub-pixel
precision, and can be computed quickly by FFT convolution. I have
implemented the generalized median as a Python module for the special
case of two dimensions, with an eye toward image processing. A few test
cases are shown to illustrate the robustness of the method.

    \subsection{The Median}\label{the-median}

We begin by describing the traditional median as follows: \[
    x_m = \underset{x}{\arg \min} \,
        \int_{\mathcal{D}}  P(x')\, \left| x-x' \right| \,dx'
\] where \(\mathcal{D}\) is the support (domain) of the PDF \(P(x)\).
This is perhaps an atypical definition, but if you think about it you
will realize that it is the median.

    \subsection{The Generalized Median}\label{the-generalized-median}

By analogy to the previous section, we define the \(N\)-dimensional
generalized median as follows: \[
    \mathbf{r}_m = \underset{\mathbf{r}}{\arg \min} \,
        \int_{\mathcal{D}} P(\mathbf{r'})\,\left| \mathbf{r-r'} \right| \,d^N r'
        = \underset{\mathbf{r}}{\arg \min} \,\,P(\mathbf{r}) * \left|\mathbf{r}\right|.
\]

    \subsection{Proposed Algorithm}\label{proposed-algorithm}

By the following algorithm, the generalized median can run on an
\(N\)-dimensional array in \(\mathcal{O}\left(n\,\log n \right)\) time,
where \(n\) is the number of data points. 1. Begin with \(P_{ij}\), a
sampled array representation of \(P(\mathbf{r})\).\(^*\) 1. Use FFT to
convolve \(P_{ij}\) with an array representation of the cone function,
\(\left| \mathbf{r} \right|\). Call the result \(C_{ij}\), which of
course represents a continuous function \(C(\mathbf{r})\). 2. Find
\((i_m,j_m)\), the index of the minimum entry in the array
representation of \(C(\mathbf{r})\). Its location is, to within the
sampling interval, an approximation of \(\mathbf{r}_m\). 3. Using a
local neighborhood of perhaps \(3^N\) pixels surrounding \((i_m,j_m)\),
fit a quadratic form to \(C_{ij}\) and minimize it to obtain a sub-pixel
estimate of \(\mathbf{r}_m\).

\(^*\) I write just two indices because I am thinking about images, but
in general my proposed algorithm can be implemented in \(N\) dimensions.

    \subsection{Calculations}\label{calculations}

Below, I perform some example calculations on test images using a Python
module, \texttt{gm.py}. In addition to the generalized median
\(\mathbf{r}_m\), I employ a related measure of the width of the
distribution, the mean absolute radius: \[
    \text{mean absolute radius} = 
    \frac{
        \int_{\mathcal{D}} P(\mathbf{r'})\,\left| \mathbf{r}_m - \mathbf{r}' \right| \,d^N r'
    }{
        \int_{\mathcal{D}} P(\mathbf{r'})\,d^N r'
    }
\] For comparison to the generalized median, I consider the centroid.
For comparison to the mean absolute radius, I consider both the
equivalent width and the RMS radius.

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}1}]:} \PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
        \PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
        \PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{image} \PY{k}{as} \PY{n+nn}{mpimg}
        \PY{k+kn}{import} \PY{n+nn}{gm}
        
        \PY{c+c1}{\PYZsh{} Coordinates for test images}
        \PY{n}{Nx} \PY{o}{=} \PY{l+m+mi}{512}
        \PY{n}{Ny} \PY{o}{=} \PY{l+m+mi}{256}
        \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{Nx}\PY{p}{,}\PY{n}{Nx}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{y} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{arange}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{Ny}\PY{p}{,}\PY{n}{Ny}\PY{o}{+}\PY{l+m+mi}{1}\PY{p}{)}
        \PY{n}{xs}\PY{p}{,}\PY{n}{ys} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{meshgrid}\PY{p}{(}\PY{n}{x}\PY{p}{,}\PY{n}{y}\PY{p}{)}
        \PY{n}{rs} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{xs}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{n}{ys}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
        \PY{c+c1}{\PYZsh{} Specify correct extent for plt.imshow(... origin=\PYZsq{}lower\PYZsq{})}
        \PY{n}{extent} \PY{o}{=} \PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{n}{x}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{n}{y}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{l+m+mf}{0.5}\PY{p}{,}\PY{n}{y}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{+}\PY{l+m+mf}{0.5}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Test image 1, precisely centered}
        \PY{n}{test1} \PY{o}{=} \PY{l+m+mf}{1.}\PY{o}{/}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{+}\PY{p}{(}\PY{n}{rs}\PY{o}{/}\PY{l+m+mf}{10.}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mf}{2.5}\PY{p}{)}
        \PY{n}{imgplot} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{test1}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{extent}\PY{o}{=}\PY{n}{extent}\PY{p}{,} 
                             \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{origin}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lower}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                             \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
        \PY{p}{(}\PY{n}{jm1}\PY{p}{,}\PY{n}{im1}\PY{p}{,}\PY{n}{delta\PYZus{}x1}\PY{p}{,}\PY{n}{delta\PYZus{}y1}\PY{p}{,}\PY{n}{meanabsrad1}\PY{p}{)} \PY{o}{=} \PY{n}{gm}\PY{o}{.}\PY{n}{gm2d}\PY{p}{(}\PY{n}{test1}\PY{p}{)}
        
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{generalized median: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{x}\PY{p}{[}\PY{n}{jm1}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}x1}\PY{p}{,}\PY{n}{y}\PY{p}{[}\PY{n}{im1}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}y1}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Compare moments}
        \PY{n}{xc1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xs}\PY{o}{*}\PY{n}{test1}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test1}\PY{p}{)}
        \PY{n}{yc1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{ys}\PY{o}{*}\PY{n}{test1}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test1}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{centroid: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xc1}\PY{p}{,}\PY{n}{yc1}\PY{p}{)}
        \PY{n}{rmsrad1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}  \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(} \PY{p}{(} \PY{p}{(} \PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xc1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{yc1}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{p}{)} \PY{o}{*} \PY{n}{test1} \PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test1}\PY{p}{)}  \PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Measures of width:}
        \PY{n}{equivrad1} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test1}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{amax}\PY{p}{(}\PY{n}{test1}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equivalent radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{equivrad1}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean abs radius: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{meanabsrad1}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RMS radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{rmsrad1}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]

        ---------------------------------------------------------------------------

        ModuleNotFoundError                       Traceback (most recent call last)

        <ipython-input-1-67046d2580f0> in <module>()
          3 import matplotlib.pyplot as plt
          4 import matplotlib.image as mpimg
    ----> 5 import gm
          6 
          7 \# Coordinates for test images


        ModuleNotFoundError: No module named 'gm'

    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}2}]:} \PY{c+c1}{\PYZsh{} Test image 2, strongly offset from center}
        \PY{n}{xtrue} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{327}
        \PY{n}{ytrue} \PY{o}{=} \PY{o}{+}\PY{l+m+mi}{102}
        \PY{n}{rs2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xtrue}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{ytrue}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
        \PY{n}{test2} \PY{o}{=} \PY{l+m+mf}{1.}\PY{o}{/}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{+}\PY{p}{(}\PY{n}{rs2}\PY{o}{/}\PY{l+m+mf}{10.}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mf}{2.5}\PY{p}{)}
        
        \PY{n}{fig}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
        \PY{n}{imgplot} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{test2}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{extent}\PY{o}{=}\PY{n}{extent}\PY{p}{,} 
                             \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{origin}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lower}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                             \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} First, give the true center value}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{true spot center: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xtrue}\PY{p}{,}\PY{n}{ytrue}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Generalized median calculation}
        \PY{p}{(}\PY{n}{jm2}\PY{p}{,}\PY{n}{im2}\PY{p}{,}\PY{n}{delta\PYZus{}x2}\PY{p}{,}\PY{n}{delta\PYZus{}y2}\PY{p}{,}\PY{n}{meanabsrad2}\PY{p}{)} \PY{o}{=} \PY{n}{gm}\PY{o}{.}\PY{n}{gm2d}\PY{p}{(}\PY{n}{test2}\PY{p}{)}
        \PY{n}{xgm2} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{jm2}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}x2}
        \PY{n}{ygm2} \PY{o}{=} \PY{n}{y}\PY{p}{[}\PY{n}{im2}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}y2}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{generalized median: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm2}\PY{p}{,}\PY{n}{ygm2}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Compare moments}
        \PY{n}{xc2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xs}\PY{o}{*}\PY{n}{test2}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test2}\PY{p}{)}
        \PY{n}{yc2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{ys}\PY{o}{*}\PY{n}{test2}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test2}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{centroid: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xc2}\PY{p}{,}\PY{n}{yc2}\PY{p}{)}
        \PY{n}{rmsrad2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}  \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(} \PY{p}{(} \PY{p}{(} \PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xc2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{yc2}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{p}{)} \PY{o}{*} \PY{n}{test2} \PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test2}\PY{p}{)}  \PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Measures of width:}
        \PY{n}{equivrad2} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test2}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{amax}\PY{p}{(}\PY{n}{test2}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equivalent radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{equivrad2}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean abs radius: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{meanabsrad2}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RMS radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{rmsrad2}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Overplot stats}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{xc2}\PY{p}{,}\PY{n}{yc2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm2}\PY{p}{,}\PY{n}{ygm2}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
true spot center:  -327 102
gm2d quadratic fit accounts for  99.99982174779316 \% of 3x3 neighborhood variance
generalized median:  -326.36883237939605 101.38157023638097
centroid:  -318.0430991539659 95.5785331767498
equivalent radius: 18.747975030984097
mean abs radius:  52.13155926579982
RMS radius: 92.70242404066751

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_6_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}3}]:} \PY{c+c1}{\PYZsh{} Now test with three sources, arranged in an equilateral triangle.}
        \PY{n}{test3} \PY{o}{=} \PY{n}{test1}\PY{o}{*}\PY{l+m+mf}{0.} \PY{c+c1}{\PYZsh{} start from a clean slate.}
        \PY{n}{rsrc} \PY{o}{=} \PY{l+m+mf}{31.}
        \PY{n}{thetasrc} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mf}{1.}\PY{o}{/}\PY{l+m+mf}{3.}\PY{p}{,}\PY{l+m+mf}{2.}\PY{o}{/}\PY{l+m+mf}{3.}\PY{p}{]}\PY{p}{)} \PY{o}{*} \PY{l+m+mf}{2.}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{o}{+} \PY{l+m+mf}{0.5}
        \PY{n}{xsrc} \PY{o}{=} \PY{n}{rsrc} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{cos}\PY{p}{(}\PY{n}{thetasrc}\PY{p}{)} \PY{o}{+} \PY{n}{xtrue}
        \PY{n}{ysrc} \PY{o}{=} \PY{n}{rsrc} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{sin}\PY{p}{(}\PY{n}{thetasrc}\PY{p}{)} \PY{o}{+} \PY{n}{ytrue}
        \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{:}
            \PY{n}{rs3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{p}{(}\PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xsrc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{ysrc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}
            \PY{n}{test3} \PY{o}{=} \PY{n}{test3} \PY{o}{+} \PY{l+m+mf}{1.}\PY{o}{/}\PY{p}{(}\PY{l+m+mi}{1}\PY{o}{+}\PY{p}{(}\PY{n}{rs3}\PY{o}{/}\PY{l+m+mf}{10.}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mf}{2.5}\PY{p}{)}
        
        \PY{n}{fig}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
        \PY{n}{imgplot} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{test3}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{extent}\PY{o}{=}\PY{n}{extent}\PY{p}{,} 
                             \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{origin}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lower}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                             \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} First, give the true center value}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{true cluster center: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xtrue}\PY{p}{,}\PY{n}{ytrue}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Generalized median calculation}
        \PY{p}{(}\PY{n}{jm3}\PY{p}{,}\PY{n}{im3}\PY{p}{,}\PY{n}{delta\PYZus{}x3}\PY{p}{,}\PY{n}{delta\PYZus{}y3}\PY{p}{,}\PY{n}{meanabsrad3}\PY{p}{)} \PY{o}{=} \PY{n}{gm}\PY{o}{.}\PY{n}{gm2d}\PY{p}{(}\PY{n}{test3}\PY{p}{)}
        \PY{n}{xgm3} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{jm3}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}x3}
        \PY{n}{ygm3} \PY{o}{=} \PY{n}{y}\PY{p}{[}\PY{n}{im3}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}y3}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{generalized median: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm3}\PY{p}{,}\PY{n}{ygm3}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Compare moments}
        \PY{n}{xc3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xs}\PY{o}{*}\PY{n}{test3}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test3}\PY{p}{)}
        \PY{n}{yc3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{ys}\PY{o}{*}\PY{n}{test3}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test3}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{centroid: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xc3}\PY{p}{,}\PY{n}{yc3}\PY{p}{)}
        \PY{n}{rmsrad3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}  \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(} \PY{p}{(} \PY{p}{(} \PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xc3}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{yc3}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{p}{)} \PY{o}{*} \PY{n}{test3} \PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test3}\PY{p}{)}  \PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Measures of width:}
        \PY{n}{equivrad3} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test3}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{amax}\PY{p}{(}\PY{n}{test3}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equivalent radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{equivrad3}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean abs radius: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{meanabsrad3}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RMS radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{rmsrad3}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Overplot stats}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{xc3}\PY{p}{,}\PY{n}{yc3}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm3}\PY{p}{,}\PY{n}{ygm3}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
true cluster center:  -327 102
gm2d quadratic fit accounts for  99.99732494195709 \% of 3x3 neighborhood variance
generalized median:  -325.3735924451872 100.36404127187268
centroid:  -317.924128435217 95.44021752805236
equivalent radius: 31.98265768873919
mean abs radius:  64.38640743637947
RMS radius: 97.19660533773553

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_7_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
{\color{incolor}In [{\color{incolor}8}]:} \PY{c+c1}{\PYZsh{} Test with shot noise, read noise, and bias}
        \PY{n}{counts} \PY{o}{=} \PY{l+m+mf}{3e2}     \PY{c+c1}{\PYZsh{} Approx max count rate}
        \PY{n}{sigma\PYZus{}read} \PY{o}{=} \PY{l+m+mi}{10}  \PY{c+c1}{\PYZsh{} RMS read noise (counts; e.g. 10 counts = 10 electrons visible)}
        \PY{n}{bias} \PY{o}{=} \PY{l+m+mf}{0.5}\PY{o}{*}\PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{randn}\PY{p}{(}\PY{p}{)} \PY{c+c1}{\PYZsh{} Uniform unsubtracted background}
        \PY{n}{readnoise} \PY{o}{=} \PY{n}{sigma\PYZus{}read} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{standard\PYZus{}normal}\PY{p}{(}\PY{n}{test3}\PY{o}{.}\PY{n}{shape}\PY{p}{)}
        \PY{n}{test4} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{random}\PY{o}{.}\PY{n}{poisson}\PY{p}{(}\PY{n}{counts}\PY{o}{*}\PY{n}{test3}\PY{p}{,} \PY{n}{test3}\PY{o}{.}\PY{n}{shape}\PY{p}{)} \PY{o}{+} \PY{n}{readnoise} \PY{o}{+} \PY{n}{bias}
        
        \PY{n}{fig}\PY{o}{=}\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{18}\PY{p}{,} \PY{l+m+mi}{16}\PY{p}{)}\PY{p}{)}
        \PY{n}{imgplot} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{imshow}\PY{p}{(}\PY{n}{test4}\PY{p}{,} \PY{n}{cmap}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{gray}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{extent}\PY{o}{=}\PY{n}{extent}\PY{p}{,} 
                             \PY{n}{aspect}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equal}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{origin}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{lower}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}
                             \PY{n}{interpolation}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bilinear}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Give the true center value, and some useful stats}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{min pixel value (counts): }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{amin}\PY{p}{(}\PY{n}{test4}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{max pixel value (counts): }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{amax}\PY{p}{(}\PY{n}{test4}\PY{p}{)}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{bias (counts): }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{bias}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{true cluster center: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xtrue}\PY{p}{,}\PY{n}{ytrue}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Generalized median calculation}
        \PY{p}{(}\PY{n}{jm4}\PY{p}{,}\PY{n}{im4}\PY{p}{,}\PY{n}{delta\PYZus{}x4}\PY{p}{,}\PY{n}{delta\PYZus{}y4}\PY{p}{,}\PY{n}{meanabsrad4}\PY{p}{)} \PY{o}{=} \PY{n}{gm}\PY{o}{.}\PY{n}{gm2d}\PY{p}{(}\PY{n}{test4}\PY{p}{)}
        \PY{n}{xgm4} \PY{o}{=} \PY{n}{x}\PY{p}{[}\PY{n}{jm4}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}x4}
        \PY{n}{ygm4} \PY{o}{=} \PY{n}{y}\PY{p}{[}\PY{n}{im4}\PY{p}{]}\PY{o}{+}\PY{n}{delta\PYZus{}y4}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{generalized median: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm4}\PY{p}{,}\PY{n}{ygm4}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Compare moments}
        \PY{n}{xc4} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{xs}\PY{o}{*}\PY{n}{test4}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test4}\PY{p}{)}
        \PY{n}{yc4} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{ys}\PY{o}{*}\PY{n}{test4}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test4}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{centroid: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xc4}\PY{p}{,}\PY{n}{yc4}\PY{p}{)}
        \PY{n}{rmsrad4} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}  \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(} \PY{p}{(} \PY{p}{(} \PY{n}{xs}\PY{o}{\PYZhy{}}\PY{n}{xc4}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{o}{+} \PY{p}{(}\PY{n}{ys}\PY{o}{\PYZhy{}}\PY{n}{yc4}\PY{p}{)}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2} \PY{p}{)} \PY{o}{*} \PY{n}{test4} \PY{p}{)} \PY{o}{/} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test4}\PY{p}{)}  \PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Measures of width:}
        \PY{n}{equivrad4} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(} \PY{n}{np}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{test4}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{amax}\PY{p}{(}\PY{n}{test4}\PY{p}{)}\PY{o}{/}\PY{n}{np}\PY{o}{.}\PY{n}{pi} \PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{equivalent radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{equivrad4}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean abs radius: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{meanabsrad4}\PY{p}{)}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{RMS radius:}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{rmsrad4}\PY{p}{)}
        
        \PY{c+c1}{\PYZsh{} Overplot stats}
        \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{xc4}\PY{p}{,}\PY{n}{yc4}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{xgm4}\PY{p}{,}\PY{n}{ygm4}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g+}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
        \PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}


    \begin{Verbatim}[commandchars=\\\{\}]
min pixel value (counts):  -45.80930391196985
max pixel value (counts):  352.1689081447326
bias (counts):  0.1443173628122475
true cluster center:  -327 102
gm2d quadratic fit accounts for  99.99789516651735 \% of 3x3 neighborhood variance
generalized median:  -322.3984401718865 99.55950018173469
centroid:  -294.351656765155 90.27773096371884
equivalent radius: 31.151696449490245
mean abs radius:  90.24753378005359
RMS radius: 157.13157507245816

    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{output_8_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \subsection{Discussion}\label{discussion}

The example images used above are meant to mimic, and perhaps
exaggerate, certain difficult features of spot images that may occur in
an experiment to determine the best focus of an optical sytem. These
include: 1. Broad tails. I have chosen the form
\(\left( 1 + r^{\frac{5}{2}} \right)^{-1}\), which is only barely
integrable. Even the first moment in this case converges only because of
the finite field of view, and therefore the first and second moments are
ill-defined. 1. Off-center presentation. That is, the spot is not well
centered in the field of view, and so the tails of the distribution (and
any background) tend to draw any measure of central tendency away from
the true center and toward the center of the frame. 1. Multi-modal
spots. I have an equilateral triangle of identical spots, but real spots
are more complicated due to diffraction effects. For this reason, I did
not consider the mode as a potential measure of central tendency. 1.
Noise, including shot noise and read noise. Consequently, the images can
contain negative pixels. 1. Uncompensated bias. While we try to remove
backgrounds such as pedestal, and dark current and diffuse backgrounds
from our images, these backgrounds can be difficult to estimate and may
fluctuate. Negative bias can contribute to the appearance of negative
pixels in the PSF wings, resulting in failure to get a second moment.
Positive bias inflates the PSF wings, drawing the centroid to the
center.

The reader is encouraged to re-run the last calculation repeatedly, to
see how different realizations of noise and bias affect the results. It
would be even better to do a MonteCarlo test to get many realizations of
noise and bias, but I think that the general characteristics of t

\subsubsection{Central Tendency}\label{central-tendency}

Throughout these experiments, the generalized median is a more
consistent and reliable measure of central tendency than the centroid.
Neither of these measures cares about multi-modal spots, but the
generalized median is less susceptible to broad tails, off-center
presentation, multi-modal spots, noise, and bias.

It is widely known that the centroid of a binned distribution (such as
an image or spectrum) can be calculated to sub-pixel accuracy. These
experiments show that the same is true of the generalized median. In
\texttt{gm2d} I find the minimum of the convolution integral to
sub-pixel accuracy by fitting a \(3\times 3\) neighborhood to a
quadratic function. Note the lines of output that say
\texttt{gm2d\ quadratic\ fit\ accounts\ for\ \ 99.998...\ \%\ of\ 3x3\ neighborhood\ variance}.
These show that the quadratic fit is an excellent description of the
neighborhood around the minimum. Of course, in cases where the central
tendency is greatly influenced by off-center presentation or other
effects, sub-pixel precision should not be confused with sub-pixel
accuracy!

\subsubsection{Width}\label{width}

The second moment, or RMS radius, computed naively as I have done, is
almost useless since enough negative pixels will render it impossible to
compute. It is also too sensitive to the distribution tails, bias, and
random noise. However, the RMS radius is not very sensitive to
off-center presentation. The mean absolute radius is somewhat more
robust than the RMS radius, but still not very good. The equivalent
width, or equivalent radius, is a very robust measure of spot width. It
is far more consistent than my other two candidates.

I did not try trimming the distribution, that is restricting
consideration to pixels with intensity greater than some minimum value,
such as a fixed fraction of the maximum intensity. This simple fix could
go a long way to making the moment-based measures more robust.

As a parting comment, I note that the equivalent width does have (at
least) one significant flaw: its reliance on the distribution maximum.
If the distribution peak is sharp on the scale of a pixel, this maximum
could fluctuate from image to image due to noise and/or sampling
effects. Provided that the diffraction limit (or other considerations)
blur the peak sufficiently, the reliance on a single maximum pixel value
will not prove to be a fatal flaw.


    % Add a bibliography block to the postdoc
    
    
    
    \end{document}
